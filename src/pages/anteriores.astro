---
// Generamos una lista falsa de compañías
const listaCompanias = ["Compañía de Circo 'eia'", "Sacékripa", "My!Laika", "JÁNIKA company", "Francine Satu", "Esteros live project", "Lupa Maimone/Oltrenotte", "Cie. Kimera", "Sofia de la Zambra"];

const ediciones = [
    { 
        year: "2028", titulo: "#5", color: "#FF3B30", 
        cartel: "/img/k-5-cartel.jpg", 
        video: "https://www.youtube.com/embed/dQw4w9WgXcQ",
        extras: ["/img/k5-1.jpg", "/img/k5-2.jpg"],
        companys: listaCompanias 
    },
    { 
        year: "2024", titulo: "#4", color: "#FFCC00", 
        cartel: "/img/k-4-cartel.jpg", 
        video: "https://www.youtube.com/embed/dQw4w9WgXcQ",
        extras: ["/img/obras/foto2.jpg", "/img/obras/foto3.jpg"],
        companys: listaCompanias
    },
    { 
        year: "2023", titulo: "#3", color: "#007AFF", 
        cartel: "/img/k-3-cartel.jpg", 
        video: "https://www.youtube.com/embed/dQw4w9WgXcQ",
        extras: ["/img/obras/foto2.jpg", "/img/obras/foto1.jpg"],
        companys: listaCompanias
    }
];
---

<div class="main-wrapper">
    <div class="horizontal-container">
        
        <!-- PANEL 1: INTRO -->
        <section class="panel intro">
            <h1>HISTÒRIA DEL FESTIVAL</h1>
            <p>Scroll horizontal →</p>
        </section>

        <!-- BUCLE DE EDICIONES -->
        {ediciones.map((ed) => (
            <section class="panel edicion">
                
                <div class="gallery-row">
                    
                    <!-- 1. INDICADOR DE AÑO -->
                    <div class="year-marker">
                        <span class="year-number" style={`color: ${ed.color}`}>{ed.year}</span>
                        <div class="year-line" style={`background: ${ed.color}`}></div>
                    </div>

                    <!-- 2. CARTEL PRINCIPAL -->
                    <div class="media-item main-cartel">
                        <img src={ed.cartel} alt={`Cartel ${ed.year}`} />
                        <span class="label">Cartell</span>
                    </div>

                    <!-- 3. VIDEO -->
                    <div class="media-item video-item">
                        <iframe src={ed.video} frameborder="0" allowfullscreen></iframe>
                        <span class="label">Video</span>
                    </div>

                    <!-- 4. FOTOS EXTRA -->
                    {ed.extras.map((img) => (
                        <div class="media-item extra-photo">
                            <img src={img} alt="Foto archivo" />
                        </div>
                    ))}

                    <!-- 5. LISTA DE COMPAÑÍAS -->
                    <div class="companies-mini-block">
                        <p>
                            {ed.companys.map((c, index) => (
                                <span>{c}{index < ed.companys.length - 1 ? ' • ' : ''}</span>
                            ))}
                        </p>
                    </div>

                </div>
            </section>
        ))}

        <section class="panel intro">
            <h1>CONTINUARÀ...</h1>
        </section>

    </div>
</div>

<style>
    .main-wrapper {
        width: 100%;
        height: 100vh;
        overflow: hidden;
        background: #000;
    }

    .horizontal-container {
        display: flex;
        height: 100%;
        width: max-content; 
    }

    .panel {
        height: 100vh;
        padding: 0 10vw;
        flex-shrink: 0;
        display: flex;
        align-items: center;
        border-right: 1px solid #222;
    }

    .intro { width: 100vw; justify-content: center; flex-direction: column; text-align: center; }
    .intro h1 { font-size: 5rem; font-weight: 900; }

    /* FILA DE GALERÍA */
    .gallery-row {
        display: flex;
        align-items: center;
        gap: 60px; /* Espacio entre cartel, video y fotos */
        position: relative;
    }

    /* INDICADOR DE AÑO (Abajo izquierda del bloque) */
    .year-marker {
        display: flex;
        flex-direction: column;
        align-items: flex-start;
        min-width: 150px;
    }

    .year-number {
        font-size: 6rem;
        font-weight: 900;
        line-height: 1;
    }

    .year-line {
        width: 100%;
        height: 10px;
        margin-top: 10px;
    }

    /* ELEMENTOS MULTIMEDIA */
    .media-item {
        height: 60vh;
        position: relative;
        background: #111;
        box-shadow: 0 20px 40px rgba(0,0,0,0.5);
    }

    .main-cartel { aspect-ratio: 2/3; }
    .video-item { aspect-ratio: 16/9; width: 60vw; }
    .extra-photo { aspect-ratio: 4/3; }

    .media-item img, .media-item iframe {
        width: 100%;
        height: 100%;
        object-fit: cover;
        display: block;
    }

    .label {
        position: absolute;
        bottom: -30px;
        left: 0;
        font-size: 0.7rem;
        text-transform: uppercase;
        letter-spacing: 2px;
        opacity: 0.5;
    }

    /* BLOQUE COMPAÑÍAS */
    .companies-mini-block {
        width: 300px;
        font-size: 0.8rem;
        line-height: 1.6;
        opacity: 0.6;
        text-align: justify;
    }

    /* RESPONSIVE */
    @media (max-width: 768px) {
        .main-wrapper { height: auto; overflow: visible; }
        .horizontal-container { flex-direction: column; width: 100%; }
        .panel { width: 100%; height: auto; padding: 50px 20px; border-right: none; border-bottom: 1px solid #222; }
        .gallery-row { flex-direction: column; gap: 40px; }
        .media-item { width: 100%; height: auto; aspect-ratio: 16/9; }
        .video-item { width: 100%; }
        .year-number { font-size: 4rem; }
    }
</style>

<script>
    import { gsap } from "gsap";
    import { ScrollTrigger } from "gsap/ScrollTrigger";
    gsap.registerPlugin(ScrollTrigger);

    const panels = gsap.utils.toArray(".panel");

    // Única animación: Desplazamiento horizontal del contenedor
    gsap.to(panels, {
        xPercent: -100 * (panels.length - 1),
        ease: "none",
        scrollTrigger: {
            trigger: ".main-wrapper",
            pin: true,
            scrub: 1,
            end: () => "+=" + document.querySelector(".horizontal-container").offsetWidth
        }
    });
</script>